---
title: 数据库(8)
date: 2024-12-27 15:45:59
tags:
    - 学习笔记
    - 数据库
---

## 文件组织形式

### 文件逻辑/物理组织

1. 逻辑结构
   - 流式文件
   - 基于记录文件
   - 基于索引的文件
2. 物理组织/结构
   - 以`block`为单位，存储在`secondary storage`例如磁盘、SSD中
   - 特征：contiguous(连续), linked(链接), indexed(索引)

DB 存储为 DB 文件的集合(包括 SQL Server， 主文件，辅文件，日志文件)。其中，每个文件都是一个记录序列，每条记录都位于一系列字段中。一种方法DB存储方法中：记录大小是固定的，每个文件仅包含一种特定类型的记录，不同的文件用于不同的关系。

每个文件都是一系列的记录，每一个关系表都是一组元组。DB的逻辑文件以元组为单位，而物理文件以记录为文件。

存在几种常见的文件存储方式，此处不做过多描述。

对于文件删除后的处理方式一般包含三种，具体可以查询资料。
对于文件组织形式一般包含四种：`Heap File Organization`、`Sequential File Organization`、`Multitable Clustering File Organization`、`Hashing File Organization`。

### 数据缓存

#### 内存与磁盘(Buffer Manager)

在数据库中，其查询数据往往需要从磁盘调入内存中。对于数据库控制数据缓存的核心思想是最小化`IO`数据的传输，并且最小化使用的内存。
在实际的数据库读写过程中，其中双层隔离性是由逻辑读写和物理读写协作完成实现的。在这个过程中，数据库操作对于内存中的内容经过逻辑读写，在内存到磁盘的途径上，通过物理读写完成。
对于内存与磁盘之间的写入写出存在很多优化算法，其中甚至包含一下预测算法，类似于分支指令集中的分支预测？在这个过程中还有锁的存在，类似于`x`锁和`s`锁，但是细微差别在于其中分别是`shared lock`和`exclusive lock`。

#### 行式存储

对于数据库存储中常见的行式存储，其本身更多的针对于一些特殊情景。

- 优点
  - Reduced IO if only some attributes are accessed
  - Improved CPU cache performance 
  - Improved compression
  - Vector processing on modern CPU architectures
- 缺点
  - Cost of tuple reconstruction from columnar representation
  - Cost of tuple deletion and update
  - Cost of decompression

**数据存储格式的选择：**

- 列式存储更适合决策支持：对于需要进行大量读取、分析和聚合计算的决策支持系统（如数据仓库），列式存储通常比行式存储更高效。
- 行式存储更适合事务处理：对于需要频繁执行插入、更新和删除操作的事务处理系统（如在线事务处理系统），行式存储可以提供更好的性能。

当列式存储的数据库被存放在内存中时，相比于行式存储，列式存储可以用于内存中的决策支持应用 压缩减少了内存需求。

### 分页存储

我从主观上认为就和操作系统中的分页存储方式一致。

#### openGauss 段页式存储管理

openGauss 数据库采用了高效的段页式存储管理策略，这种策略类似于操作系统中的分页系统，但专门优化以适应数据库的需求。在 openGauss 中，存储结构被细分为几个关键组成部分：

1. **段（Segment）**：
   - 数据库中的每个数据库对象（如表、索引）都存储在称为"段"的结构中。每个段可以看作是数据库对象的物理和逻辑集合，它包含了一个或多个区（Extent）。

2. **区（Extent）**：
   - 一个区是由连续的页（Page）组成的，是段中的一个逻辑分区。每个区包含固定数量的页，这些页连续存储在磁盘上，从而减少数据访问时的磁盘寻址时间。

3. **页（Page）**：
   - 页是 openGauss 数据存储的基本单位，类似于操作系统中的内存页。每个页的大小固定，通常为 8KB。页内存储具体的数据行或索引条目，设计成固定大小有利于快速定位和数据一致性保证。

##### 存储管理特点

- **高效的空间利用**：通过将数据细分为段和区，openGauss 能够有效管理磁盘空间，减少碎片，提高数据存取效率。
- **数据局部性优化**：相关数据存储在相邻的页中，提升查询效率，尤其是对于表扫描和范围查询。
- **动态空间管理**：openGauss 能够动态分配和回收段和区的空间，根据数据库负载和数据增长自动调整，提供灵活的存储管理。
- **事务和恢复**：每个页都包含有关其修改的信息，这些信息在事务处理和数据恢复中至关重要，确保了数据的一致性和可靠性。

##### Oracle数据库中的7种数据库表类型

Oracle 数据库支持多种类型的表，每种表的组织方式对于不同的应用场景提供了特定的优势和功能。以下是这些表类型的详细介绍：

1. 堆表（Heap-Organized Table）
  堆表是 Oracle 和 openGauss 中的默认表类型。在这种类型的表中，数据在写入时无需考虑行存放的顺序，通常是按照写入时间的先后顺序存放。这样的存储方式使得写入速度较 
  高，但由于数据是无序存放的，其读取效率相对较低。

2. 索引组织表（Index-Organized Table, IOT）
  索引组织表以索引的方式保存表数据，数据根据主键的顺序进行存储排列，这种方式显著提高了数据的访问速度。然而，这种类型的表的索引块需要保存所有字段的信息，因此需要更多 
  的叶子页面来保存数据，可能在数据量较大时导致访问效率降低。如果主键频繁修改，对应的行也需要在不同的块之间移动，这会增加磁盘I/O和维护成本。

3. 簇表（Cluster Table）
  簇表（Cluster）允许根据连接键（Join Key）将多个数据表的数据保存在同一个数据库段中。这样做可以在某些场景下实现快速检索和连接。然而，在 openGauss 中，无法兼容 
  此功能。

4. 临时表（Temporary Table）
  临时表是一种特殊类型的表，用于临时保存数据。这些表的数据只存储在临时表空间中，而非用户表空间，且对临时表的DML操作通常不记录事务日志。Oracle 临时表分为事务级临时 
  表和会话级临时表，前者的数据只保存在事务的生命周期中，后者能支持会话的完整生命周期。

5. 压缩表（Compressed Table）
  通过对表数据进行压缩，可以节省存储空间，但压缩和解压缩过程需要消耗一定的CPU资源。Oracle 提供了基础压缩和OLTP压缩两种常用的压缩方式。

6. 分区表（Partitioned Table）
  分区表将大表按照规则分解成多张具有独立存储空间的实体表，面向应用是一张表，但物理上由多个分区组成。每个分区都是一个独立对象，可以单独处理，也可以作为更大对象的一部 
   分。分区类型包括范围分区、列表分区、哈希分区和复合分区。
  
  - **范围分区**：根据数据表的某个值范围进行分区。
  - **列表分区**：根据所有可能的值，指定应该插入哪个分区。

7. 嵌套表（Nested Table）
  嵌套表允许将一张表作为另一张表的列存储，这对于存储复杂数据类型和支持对象关系特性尤为有用。

